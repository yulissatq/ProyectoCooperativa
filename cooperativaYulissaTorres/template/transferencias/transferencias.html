{% extends 'master/master.html' %}


{% block contenido%}
<div class="row mt">
        <div class="col-md-12">
            <div class="content-panel">

                <!-- buscar cuenta origen -->
                    <table class="table table-striped table-advance table-hover">
                        <div class="row mt">
                            <div class="col-lg-12">
                                <div class="form-panel">
                                      <h4 class="mb"><i class="fa fa-angle-right"></i> Buscar Cuenta Origen</h4>
                                    <form class="form-inline" role="form">
                                        <div class="form-group">
                                            <input  class="form-control" id="txt_num_origen"   placeholder="Ingrese Número de Cuenta Origen a Buscar">
                                        </div>
                                        <center><button type="button"  class="btn btn-theme" id="btn_Buscar_Deposito" onclick=buscarOrigen()>Buscar</button></center>
                                    </form>
                                </div><!-- /form-panel -->
                            </div><!-- /col-lg-12 -->
                        </div><!-- /row -->
                     </table>
                <!-- fin buscar cuenta origen -->
                <div id="msgOrigen">

                </div>
                <!-- cuenta origen -->
                <div class="row mt" id="contenidoOrigen" style="display: none">
                        <div class="col-lg-12">
                            <div class="form-panel">
                                    <h4 class="mb"><i class="fa fa-angle-right"></i> Datos Cuenta Origen: </h4>
                                <form class="form-horizontal style-form" method="post">
                                        
                                     <div class="form-group">
                                        <label class="col-sm-2 col-sm-2 control-label">Cedula:</label>
                                        <div class="col-sm-10">
                                            <input class="form-control" id="cedulaOrigen" type="text" disabled="">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 col-sm-2 control-label">Nombres:</label>
                                        <div class="col-sm-10">
                                            <input class="form-control" id="nombresOrigen" type="text" disabled="">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="col-sm-2 col-sm-2 control-label">Número de Cuenta</label>
                                        <div class="col-sm-10"> 
                                            <input class="form-control" id="numeroOrigen" type="text" disabled="">
                                        </div>
                                    </div>    
                                    <div class="form-group">
                                        <label class="col-sm-2 col-sm-2 control-label">Saldo:</label>
                                        <div class="col-sm-10">
                                            <input class="form-control" id="saldoOrigen" type="text" disabled="">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 col-sm-2 control-label">Tipo de Cuenta:</label>
                                        <div class="col-sm-10">
                                            <input class="form-control" id="tipoOrigen" type="text" disabled="">
                                        </div>
                                    </div> 
                                        
                                </form>

                            </div>
                        </div><!-- col-lg-12-->      	
                    </div><!-- /row -->
            
                <!-- fin cuenta origen -->
                <br>
                <!-- buscar cuenta Destino -->
                <table class="table table-striped table-advance table-hover">
                        <div class="row mt">
                            <div class="col-lg-12">
                                <div class="form-panel">
                                      <h4 class="mb"><i class="fa fa-angle-right"></i> Buscar Cuenta Destino</h4>
                                    <form class="form-inline" role="form">
                                        <div class="form-group">
                                            <input  class="form-control" id="txt_num_Destino"   placeholder="Ingrese Número de Cuenta Destino a Buscar">
                                        </div>
                                        <center><button type="button"  class="btn btn-theme" id="btn_Buscar_Destino" onclick=buscarDestino()>Buscar</button></center>
                                    </form>
                                </div><!-- /form-panel -->
                            </div><!-- /col-lg-12 -->
                        </div><!-- /row -->
                     </table>
                <!-- fin buscar cuenta destino -->
                <div id="msgDestino">

                </div>

                <!-- cuenta destino -->
                
                <div class="row mt" id="contenidoDestino" style="display: none">
                        <div class="col-lg-12">
                            <div class="form-panel">
                                    <h4 class="mb"><i class="fa fa-angle-right"></i> Datos Cuenta Destino: </h4>
                                <form class="form-horizontal style-form" method="post">
                                        
                                     <div class="form-group">
                                        <label class="col-sm-2 col-sm-2 control-label">Cedula:</label>
                                        <div class="col-sm-10">
                                            <input class="form-control" id="cedulaDestino" type="text" disabled="">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 col-sm-2 control-label">Nombres:</label>
                                        <div class="col-sm-10">
                                            <input class="form-control" id="nombresDestino" type="text" disabled="">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="col-sm-2 col-sm-2 control-label">Número de Cuenta</label>
                                        <div class="col-sm-10"> 
                                            <input class="form-control" id="numeroDestino" type="text" disabled="">
                                        </div>
                                    </div>    
                                    <div class="form-group">
                                        <label class="col-sm-2 col-sm-2 control-label">Saldo:</label>
                                        <div class="col-sm-10">
                                            <input class="form-control" id="saldoDestino" type="text" disabled="">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 col-sm-2 control-label">Tipo de Cuenta:</label>
                                        <div class="col-sm-10">
                                            <input class="form-control" id="tipoDestino" type="text" disabled="">
                                        </div>
                                    </div> 
                                        
                                </form>

                            </div>
                        </div><!-- col-lg-12-->      	
                    </div><!-- /row -->
            
                        <!-- fin cuenta destino -->

                        <!-- botones -->
                        <div class="row mt" >
                            <div class="col-lg-12">
                                <div class="form-panel">
                                    <form class="form-horizontal style-form" method="post"></form>
                                            <center>
                                            <input class = "btn waves-effect waves-light" type="button"  id="btn_transferir" data-toggle="modal" data-target="#exampleModalCenter" onclick=transferirDinero() value="TRANSFERIR">
                                            <input class = "btn waves-effect waves-light" type="button" onclick=cancelar() data-dismiss="modal" value="CANCELAR">
                                            </center>
                                            
                                    </form>
                                </div>
                            
                            </div><!-- col-lg-12-->      	
                        </div><!-- /row -->
                        <!-- fin bbotones -->

                        <!-- modal -->
                        <div class="modal fade"  id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <div class="modal-header"> 
                                      <h4 class="modal-title" id="exampleModalLongTitle"><i class="fa fa-angle-right"></i> Transferencia de Dinero: </h4>
                                      <button type="button" class="close" data-dismiss="modal" aria-label="close">
                                          <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>

                                    <div class="modal-body">
                                        <div class="form-horizontal style-form">
                                        
                                        <div class="form-group">
                                            <label class="col-sm-2 col-sm-2 control-label">Valor:</label>
                                            <div class="col-sm-10">
                                                <input name="valor" step="0.001" id="id_valor" required="" type="number">
                                            </div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="col-sm-2 col-sm-2 control-label">Descripción:</label>
                                            <div class="col-sm-10"> 
                                              <textarea name="descripcion" cols="40" rows="10" id="id_descripcion"></textarea>
                                            </div>
                                        </div>    
                                        <div class="form-group">
                                            <label class="col-sm-2 col-sm-2 control-label">Responsable:</label>
                                            <div class="col-sm-10">
                                                <input name="responsable" maxlength="160" id="id_responsable" required="" type="text">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 col-sm-2 control-label">Clave de Confirmación:</label>
                                            <div class="col-sm-10">
                                                <input class="form-control"   id="id_passwordtransf" required="" type="password" placeholder="Ingrese Clave de Confirmación">
                                            </div>
                                        </div>

                                        <div id="mensaje_confirmacion">

                                        </div>
                                    </div>

                                </div>
                                <div class="modal-footer">
                                        <center>
                                        <input class = "btn waves-effect waves-light" id="btn_realizarTransf" type="submit" onclick=generarTransferencia() value="CONFIRMAR">
                                        <input class = "btn waves-effect waves-light" type="button" onclick=cancelar() value="CANCELAR">
                                        </center>
                                </div>
                            </div>
                        </div>

                                  
                        {% csrf_token %} 
            </div><!-- /content-panel -->
        </div><!-- /col-md-12 -->
    </div><!-- /row -->
    
                
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>                                
    <script >

        function cancelar(){
            window.location.href = '{%url "transferencias" %}'
        }
                
        $('#btn_transferir').attr('disabled', 'disabled')
        var busqOrigen =false;
        var busDestino = false

        function buscarOrigen() {
            var num = $('#txt_num_origen').val()
            var div = $('#contenidoOrigen')
            var tr = $('#transferir')
            
            $.ajax({
                type: "GET",
                url: "{%url 'buscarTranferenciaOrigen' %}",
                data: "numero=" + num,
                success: function (data) {
                    
                    if (data) {
                        $('#msgOrigen').html('<div class="alert alert-success"><b>Cuenta Encontrada!</b> Selecione en la parte inferior la Cuenta a la que se transferirá el dinero.</div>')
                        arreglo = data.split(";")
                        div.show()
                        $('#cedulaOrigen').val(arreglo[0])
                        $('#nombresOrigen').val(arreglo[1] + " " + arreglo[2])
                        $('#numeroOrigen').val(arreglo[4])
                        $('#saldoOrigen').val(arreglo[5])
                        $('#tipoOrigen').val(arreglo[6])
                        busqOrigen=true;
                        if (busDestino){
                            $('#btn_transferir').removeAttr('disabled', "")
                        }else{
                            $('#btn_transferir').attr('disabled', 'disabled')
                        }

                    } else {
                        $('#msgOrigen').html('<div class="alert alert-danger"><b>Cuenta no encontrada!</b> Verifique el numero de Cuenta</div>')
                        div.hide()
                        $('#cedulaOrigen').val('')
                        $('#nombresOrigen').val('')
                        $('#numeroOrigen').val('')
                        $('#saldoOrigen').val('')
                        $('#tipoOrigen').val('')
                        tr.hide()
                    }
                }
            });

        }

        function buscarDestino() {
            var num = $('#txt_num_Destino').val()
            var div = $('#contenidoDestino')
            var tr = $('#transferir')
            $.ajax({
                type: "GET",
                url: "{%url 'buscarTranferenciaOrigen' %}",
                data: "numero=" + num,
                success: function (data) {
                    if (data) {
                        $('#msgDestino').html('<div class="alert alert-success"><b>Cuenta Encontrada!</b> </div>')
                        arreglo = data.split(";")
                        div.show()
                        $('#cedulaDestino').val(arreglo[0])
                        $('#nombresDestino').val(arreglo[1] + " " + arreglo[2])
                        $('#numeroDestino').val(arreglo[4])
                        $('#saldoDestino').val(arreglo[5])
                        $('#tipoDestino').val(arreglo[6])
                        busDestino=true;
                        if (busqOrigen){
                            $('#btn_transferir').removeAttr('disabled', "")
                        }else{
                            $('#btn_transferir').attr('disabled', 'disabled')
                        }
                        tr.show()
                    } else {
                        $('#msgDestino').html('<div class="alert alert-danger"><b>Cuenta no encontrada!</b> verifique el numero de Cuenta</div>')
                        div.hide()
                        $('#cedulaDestino').val('')
                        $('#nombresDestino').val('')
                        $('#numeroDestino').val('')
                        $('#saldoDestino').val('')
                        $('#tipoDestino').val('')
                        tr.hide()
                    }
                }
            });

        }
        function transferirDinero() { 
            var descripcion = $('#id_descripcion')    
            var numero1 = $('#numeroOrigen').val()
            var numero2 = $('#numeroDestino').val()
            
            descripcion.val("Num. Cta. Origen: "+numero1 + "\n" +" Num. Cta. Destino: "+numero2)
            var request = $.ajax({
                url: "{% url 'obtenerUser' %}",
                success: function(user){
                
                $('#id_responsable').val(user)
                    }
                })
        }

        function generarTransferencia(){
            var valor = $('#id_valor').val()
            var descripcion = $('#id_descripcion').val()
            var responsable = $('#id_responsable').val()
            var cedula1 = $('#cedulaOrigen').val()
            var numero1 = $('#numeroOrigen').val()
            var cedula2 =  $('#cedulaDestino').val()
            var numero2 = $('#numeroDestino').val()
            
           
            window.location.href = '{%url "transferencia" %}' + '?numero1=' + numero1+'&&cedula1='+cedula1+'&&numero2='+numero2+'&&cedula2='+cedula2+'&&monto='+valor+'&&descripcion='+descripcion+'&&responsable='+responsable
            
        }

        $('#id_passwordtransf').change(function(){
            $.ajax({
                url: "{% url 'confirmar' %}" + '?contrasena=' + $('#id_passwordtransf').val(),
                success: function (user){
                    if (user == 'True'){
                        $('#mensaje_confirmacion').html('<div class="alert alert-success"><b>Clave de Confirmación Correcta</b> </div>')
                        $('#btn_realizarTransf').removeAttr('disabled', "")
                        $('#clave_confirmacion').removeClass('has-error')
                        $('#clave_confirmacion').addClass('has-success')
                    }else{
                        $('#clave_confirmacion').removeClass('has-error')
                        $('#clave_confirmacion').addClass('has-success')
                        $('#btn_realizarTransf').attr('disabled', 'disabled')
                        $('#mensaje_confirmacion').html('<div class="alert alert-danger"><b>Clave de Confirmación Incorrecta</b> </div>')
                    }
                }
            })
        })

    </script>
    {% endblock%}
